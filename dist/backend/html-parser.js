System.register([], function (_export) {
	"use strict";

	var startTag, endTag, attr, empty, block, inline, closeSelf, fillAttrs, special, HTMLParser;

	function makeMap(str) {
		var obj = {},
		    items = str.split(",");
		for (var i = 0; i < items.length; i++) obj[items[i]] = true;
		return obj;
	}
	return {
		setters: [],
		execute: function () {
			startTag = /^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/;
			endTag = /^<\/([-A-Za-z0-9_]+)[^>]*>/;
			attr = /([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;
			empty = makeMap("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr");
			block = makeMap("a,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video");
			inline = makeMap("abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");
			closeSelf = makeMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");
			fillAttrs = makeMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");
			special = makeMap("script,style,source-code,narrative");

			HTMLParser = function HTMLParser(html, handler) {
				var index,
				    chars,
				    match,
				    stack = [],
				    last = html;
				stack.last = function () {
					return this[this.length - 1];
				};

				while (html) {
					chars = true;

					if (!stack.last() || !special[stack.last()]) {
						if (html.indexOf("<!--") == 0) {
							index = html.indexOf("-->");

							if (index >= 0) {
								if (handler.comment) handler.comment(html.substring(4, index));
								html = html.substring(index + 3);
								chars = false;
							}
						} else if (html.indexOf("</") == 0) {
								match = html.match(endTag);

								if (match) {
									html = html.substring(match[0].length);
									match[0].replace(endTag, parseEndTag);
									chars = false;
								}
							} else if (html.indexOf("<") == 0) {
									match = html.match(startTag);

									if (match) {
										html = html.substring(match[0].length);
										match[0].replace(startTag, parseStartTag);
										chars = false;
									}
								}

						if (chars) {
							index = html.indexOf("<");

							var text = index < 0 ? html : html.substring(0, index);
							html = index < 0 ? "" : html.substring(index);

							if (handler.chars) handler.chars(text);
						}
					} else {
						html = html.replace(new RegExp("([\\s\\S]*?)<\/" + stack.last() + "[^>]*>"), function (all, text) {
							text = text.replace(/<!--([\s\S]*?)-->|<!\[CDATA\[([\s\S]*?)]]>/g, "$1$2");
							if (handler.chars) handler.chars(text);

							return "";
						});

						parseEndTag("", stack.last());
					}

					if (html == last) throw "Parse Error: " + html;
					last = html;
				}

				parseEndTag();

				function parseStartTag(tag, tagName, rest, unary) {
					tagName = tagName.toLowerCase();

					if (block[tagName]) {
						while (stack.last() && inline[stack.last()]) {
							parseEndTag("", stack.last());
						}
					}

					if (closeSelf[tagName] && stack.last() == tagName) {
						parseEndTag("", tagName);
					}

					unary = empty[tagName] || !!unary;

					if (!unary) stack.push(tagName);

					if (handler.start) {
						var attrs = [];

						rest.replace(attr, function (match, name) {
							var value = arguments[2] ? arguments[2] : arguments[3] ? arguments[3] : arguments[4] ? arguments[4] : fillAttrs[name] ? name : "";

							attrs.push({
								name: name,
								value: value,
								escaped: value.replace(/(^|[^\\])"/g, '$1\\\"') });
						});

						if (handler.start) handler.start(tagName, attrs, unary);
					}
				}

				function parseEndTag(tag, tagName) {
					if (!tagName) var pos = 0;else for (var pos = stack.length - 1; pos >= 0; pos--) if (stack[pos] == tagName) break;

					if (pos >= 0) {
						for (var i = stack.length - 1; i >= pos; i--) if (handler.end) handler.end(stack[i]);

						stack.length = pos;
					}
				}
			};

			_export("HTMLParser", HTMLParser);
		}
	};
});
//# sourceMappingURL=data:application/json;base64,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Ii8vIFJlZ3VsYXIgRXhwcmVzc2lvbnMgZm9yIHBhcnNpbmcgdGFncyBhbmQgYXR0cmlidXRlc1xudmFyIHN0YXJ0VGFnID0gL148KFstQS1aYS16MC05X10rKSgoPzpcXHMrW2EtekEtWl86XVstYS16QS1aMC05XzouXSooPzpcXHMqPVxccyooPzooPzpcIlteXCJdKlwiKXwoPzonW14nXSonKXxbXj5cXHNdKykpPykqKVxccyooXFwvPyk+Lyxcblx0ZW5kVGFnID0gL148XFwvKFstQS1aYS16MC05X10rKVtePl0qPi8sXG5cdGF0dHIgPSAvKFthLXpBLVpfOl1bLWEtekEtWjAtOV86Ll0qKSg/Olxccyo9XFxzKig/Oig/OlwiKCg/OlxcXFwufFteXCJdKSopXCIpfCg/OicoKD86XFxcXC58W14nXSkqKScpfChbXj5cXHNdKykpKT8vZztcblxuLy8gRW1wdHkgRWxlbWVudHMgLSBIVE1MIDVcbnZhciBlbXB0eSA9IG1ha2VNYXAoXCJhcmVhLGJhc2UsYmFzZWZvbnQsYnIsY29sLGZyYW1lLGhyLGltZyxpbnB1dCxsaW5rLG1ldGEscGFyYW0sZW1iZWQsY29tbWFuZCxrZXlnZW4sc291cmNlLHRyYWNrLHdiclwiKTtcblxuLy8gQmxvY2sgRWxlbWVudHMgLSBIVE1MIDVcbnZhciBibG9jayA9IG1ha2VNYXAoXCJhLGFkZHJlc3MsYXJ0aWNsZSxhcHBsZXQsYXNpZGUsYXVkaW8sYmxvY2txdW90ZSxidXR0b24sY2FudmFzLGNlbnRlcixkZCxkZWwsZGlyLGRpdixkbCxkdCxmaWVsZHNldCxmaWdjYXB0aW9uLGZpZ3VyZSxmb290ZXIsZm9ybSxmcmFtZXNldCxoMSxoMixoMyxoNCxoNSxoNixoZWFkZXIsaGdyb3VwLGhyLGlmcmFtZSxpbnMsaXNpbmRleCxsaSxtYXAsbWVudSxub2ZyYW1lcyxub3NjcmlwdCxvYmplY3Qsb2wsb3V0cHV0LHAscHJlLHNlY3Rpb24sc2NyaXB0LHRhYmxlLHRib2R5LHRkLHRmb290LHRoLHRoZWFkLHRyLHVsLHZpZGVvXCIpO1xuXG4vLyBJbmxpbmUgRWxlbWVudHMgLSBIVE1MIDVcbnZhciBpbmxpbmUgPSBtYWtlTWFwKFwiYWJicixhY3JvbnltLGFwcGxldCxiLGJhc2Vmb250LGJkbyxiaWcsYnIsYnV0dG9uLGNpdGUsY29kZSxkZWwsZGZuLGVtLGZvbnQsaSxpZnJhbWUsaW1nLGlucHV0LGlucyxrYmQsbGFiZWwsbWFwLG9iamVjdCxxLHMsc2FtcCxzY3JpcHQsc2VsZWN0LHNtYWxsLHNwYW4sc3RyaWtlLHN0cm9uZyxzdWIsc3VwLHRleHRhcmVhLHR0LHUsdmFyXCIpO1xuXG4vLyBFbGVtZW50cyB0aGF0IHlvdSBjYW4sIGludGVudGlvbmFsbHksIGxlYXZlIG9wZW5cbi8vIChhbmQgd2hpY2ggY2xvc2UgdGhlbXNlbHZlcylcbnZhciBjbG9zZVNlbGYgPSBtYWtlTWFwKFwiY29sZ3JvdXAsZGQsZHQsbGksb3B0aW9ucyxwLHRkLHRmb290LHRoLHRoZWFkLHRyXCIpO1xuXG4vLyBBdHRyaWJ1dGVzIHRoYXQgaGF2ZSB0aGVpciB2YWx1ZXMgZmlsbGVkIGluIGRpc2FibGVkPVwiZGlzYWJsZWRcIlxudmFyIGZpbGxBdHRycyA9IG1ha2VNYXAoXCJjaGVja2VkLGNvbXBhY3QsZGVjbGFyZSxkZWZlcixkaXNhYmxlZCxpc21hcCxtdWx0aXBsZSxub2hyZWYsbm9yZXNpemUsbm9zaGFkZSxub3dyYXAscmVhZG9ubHksc2VsZWN0ZWRcIik7XG5cbi8vIFNwZWNpYWwgRWxlbWVudHMgKGNhbiBjb250YWluIGFueXRoaW5nKVxudmFyIHNwZWNpYWwgPSBtYWtlTWFwKFwic2NyaXB0LHN0eWxlLHNvdXJjZS1jb2RlLG5hcnJhdGl2ZVwiKTtcblxuZXhwb3J0IGxldCBIVE1MUGFyc2VyID0gZnVuY3Rpb24gKGh0bWwsIGhhbmRsZXIpIHtcblx0dmFyIGluZGV4LCBjaGFycywgbWF0Y2gsIHN0YWNrID0gW10sIGxhc3QgPSBodG1sO1xuXHRzdGFjay5sYXN0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzW3RoaXMubGVuZ3RoIC0gMV07XG5cdH07XG5cblx0d2hpbGUgKGh0bWwpIHtcblx0XHRjaGFycyA9IHRydWU7XG5cblx0XHQvLyBNYWtlIHN1cmUgd2UncmUgbm90IGluIGEgc2NyaXB0IG9yIHN0eWxlIGVsZW1lbnRcblx0XHRpZiAoIXN0YWNrLmxhc3QoKSB8fCAhc3BlY2lhbFtzdGFjay5sYXN0KCldKSB7XG5cblx0XHRcdC8vIENvbW1lbnRcblx0XHRcdGlmIChodG1sLmluZGV4T2YoXCI8IS0tXCIpID09IDApIHtcblx0XHRcdFx0aW5kZXggPSBodG1sLmluZGV4T2YoXCItLT5cIik7XG5cblx0XHRcdFx0aWYgKGluZGV4ID49IDApIHtcblx0XHRcdFx0XHRpZiAoaGFuZGxlci5jb21tZW50KVxuXHRcdFx0XHRcdFx0aGFuZGxlci5jb21tZW50KGh0bWwuc3Vic3RyaW5nKDQsIGluZGV4KSk7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwuc3Vic3RyaW5nKGluZGV4ICsgMyk7XG5cdFx0XHRcdFx0Y2hhcnMgPSBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGVuZCB0YWdcblx0XHRcdH0gZWxzZSBpZiAoaHRtbC5pbmRleE9mKFwiPC9cIikgPT0gMCkge1xuXHRcdFx0XHRtYXRjaCA9IGh0bWwubWF0Y2goZW5kVGFnKTtcblxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdFx0XHRodG1sID0gaHRtbC5zdWJzdHJpbmcobWF0Y2hbMF0ubGVuZ3RoKTtcblx0XHRcdFx0XHRtYXRjaFswXS5yZXBsYWNlKGVuZFRhZywgcGFyc2VFbmRUYWcpO1xuXHRcdFx0XHRcdGNoYXJzID0gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBzdGFydCB0YWdcblx0XHRcdH0gZWxzZSBpZiAoaHRtbC5pbmRleE9mKFwiPFwiKSA9PSAwKSB7XG5cdFx0XHRcdG1hdGNoID0gaHRtbC5tYXRjaChzdGFydFRhZyk7XG5cblx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwuc3Vic3RyaW5nKG1hdGNoWzBdLmxlbmd0aCk7XG5cdFx0XHRcdFx0bWF0Y2hbMF0ucmVwbGFjZShzdGFydFRhZywgcGFyc2VTdGFydFRhZyk7XG5cdFx0XHRcdFx0Y2hhcnMgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY2hhcnMpIHtcblx0XHRcdFx0aW5kZXggPSBodG1sLmluZGV4T2YoXCI8XCIpO1xuXG5cdFx0XHRcdHZhciB0ZXh0ID0gaW5kZXggPCAwID8gaHRtbCA6IGh0bWwuc3Vic3RyaW5nKDAsIGluZGV4KTtcblx0XHRcdFx0aHRtbCA9IGluZGV4IDwgMCA/IFwiXCIgOiBodG1sLnN1YnN0cmluZyhpbmRleCk7XG5cblx0XHRcdFx0aWYgKGhhbmRsZXIuY2hhcnMpXG5cdFx0XHRcdFx0aGFuZGxlci5jaGFycyh0ZXh0KTtcblx0XHRcdH1cblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRodG1sID0gaHRtbC5yZXBsYWNlKG5ldyBSZWdFeHAoXCIoW1xcXFxzXFxcXFNdKj8pPFxcL1wiICsgc3RhY2subGFzdCgpICsgXCJbXj5dKj5cIiksIGZ1bmN0aW9uIChhbGwsIHRleHQpIHtcblx0XHRcdFx0dGV4dCA9IHRleHQucmVwbGFjZSgvPCEtLShbXFxzXFxTXSo/KS0tPnw8IVxcW0NEQVRBXFxbKFtcXHNcXFNdKj8pXV0+L2csIFwiJDEkMlwiKTtcblx0XHRcdFx0aWYgKGhhbmRsZXIuY2hhcnMpXG5cdFx0XHRcdFx0aGFuZGxlci5jaGFycyh0ZXh0KTtcblxuXHRcdFx0XHRyZXR1cm4gXCJcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHRwYXJzZUVuZFRhZyhcIlwiLCBzdGFjay5sYXN0KCkpO1xuXHRcdH1cblxuXHRcdGlmIChodG1sID09IGxhc3QpXG5cdFx0XHR0aHJvdyBcIlBhcnNlIEVycm9yOiBcIiArIGh0bWw7XG5cdFx0bGFzdCA9IGh0bWw7XG5cdH1cblxuXHQvLyBDbGVhbiB1cCBhbnkgcmVtYWluaW5nIHRhZ3Ncblx0cGFyc2VFbmRUYWcoKTtcblxuXHRmdW5jdGlvbiBwYXJzZVN0YXJ0VGFnKHRhZywgdGFnTmFtZSwgcmVzdCwgdW5hcnkpIHtcblx0XHR0YWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0aWYgKGJsb2NrW3RhZ05hbWVdKSB7XG5cdFx0XHR3aGlsZSAoc3RhY2subGFzdCgpICYmIGlubGluZVtzdGFjay5sYXN0KCldKSB7XG5cdFx0XHRcdHBhcnNlRW5kVGFnKFwiXCIsIHN0YWNrLmxhc3QoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGNsb3NlU2VsZlt0YWdOYW1lXSAmJiBzdGFjay5sYXN0KCkgPT0gdGFnTmFtZSkge1xuXHRcdFx0cGFyc2VFbmRUYWcoXCJcIiwgdGFnTmFtZSk7XG5cdFx0fVxuXG5cdFx0dW5hcnkgPSBlbXB0eVt0YWdOYW1lXSB8fCAhIXVuYXJ5O1xuXG5cdFx0aWYgKCF1bmFyeSlcblx0XHRcdHN0YWNrLnB1c2godGFnTmFtZSk7XG5cblx0XHRpZiAoaGFuZGxlci5zdGFydCkge1xuXHRcdFx0dmFyIGF0dHJzID0gW107XG5cblx0XHRcdHJlc3QucmVwbGFjZShhdHRyLCBmdW5jdGlvbiAobWF0Y2gsIG5hbWUpIHtcblx0XHRcdFx0dmFyIHZhbHVlID0gYXJndW1lbnRzWzJdID8gYXJndW1lbnRzWzJdIDpcblx0XHRcdFx0XHRhcmd1bWVudHNbM10gPyBhcmd1bWVudHNbM10gOlxuXHRcdFx0XHRcdGFyZ3VtZW50c1s0XSA/IGFyZ3VtZW50c1s0XSA6XG5cdFx0XHRcdFx0ZmlsbEF0dHJzW25hbWVdID8gbmFtZSA6IFwiXCI7XG5cblx0XHRcdFx0YXR0cnMucHVzaCh7XG5cdFx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0XHR2YWx1ZTogdmFsdWUsXG5cdFx0XHRcdFx0ZXNjYXBlZDogdmFsdWUucmVwbGFjZSgvKF58W15cXFxcXSlcIi9nLCAnJDFcXFxcXFxcIicpIC8vXCJcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKGhhbmRsZXIuc3RhcnQpXG5cdFx0XHRcdGhhbmRsZXIuc3RhcnQodGFnTmFtZSwgYXR0cnMsIHVuYXJ5KTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBwYXJzZUVuZFRhZyh0YWcsIHRhZ05hbWUpIHtcblx0XHQvLyBJZiBubyB0YWcgbmFtZSBpcyBwcm92aWRlZCwgY2xlYW4gc2hvcFxuXHRcdGlmICghdGFnTmFtZSlcblx0XHRcdHZhciBwb3MgPSAwO1xuXG5cdFx0XHQvLyBGaW5kIHRoZSBjbG9zZXN0IG9wZW5lZCB0YWcgb2YgdGhlIHNhbWUgdHlwZVxuXHRcdGVsc2Vcblx0XHRcdGZvciAodmFyIHBvcyA9IHN0YWNrLmxlbmd0aCAtIDE7IHBvcyA+PSAwOyBwb3MtLSlcblx0XHRcdFx0aWYgKHN0YWNrW3Bvc10gPT0gdGFnTmFtZSlcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdGlmIChwb3MgPj0gMCkge1xuXHRcdFx0Ly8gQ2xvc2UgYWxsIHRoZSBvcGVuIGVsZW1lbnRzLCB1cCB0aGUgc3RhY2tcblx0XHRcdGZvciAodmFyIGkgPSBzdGFjay5sZW5ndGggLSAxOyBpID49IHBvczsgaS0tKVxuXHRcdFx0XHRpZiAoaGFuZGxlci5lbmQpXG5cdFx0XHRcdFx0aGFuZGxlci5lbmQoc3RhY2tbaV0pO1xuXG5cdFx0XHQvLyBSZW1vdmUgdGhlIG9wZW4gZWxlbWVudHMgZnJvbSB0aGUgc3RhY2tcblx0XHRcdHN0YWNrLmxlbmd0aCA9IHBvcztcblx0XHR9XG5cdH1cbn07XG5cbmZ1bmN0aW9uIG1ha2VNYXAoc3RyKSB7XG5cdHZhciBvYmogPSB7fSwgaXRlbXMgPSBzdHIuc3BsaXQoXCIsXCIpO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKVxuXHRcdG9ialtpdGVtc1tpXV0gPSB0cnVlO1xuXHRyZXR1cm4gb2JqO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
