System.register([], function (_export) {
	"use strict";

	var startTag, endTag, attr, empty, block, inline, closeSelf, fillAttrs, special, HTMLParser;

	function makeMap(str) {
		var obj = {},
		    items = str.split(",");
		for (var i = 0; i < items.length; i++) obj[items[i]] = true;
		return obj;
	}
	return {
		setters: [],
		execute: function () {
			startTag = /^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/;
			endTag = /^<\/([-A-Za-z0-9_]+)[^>]*>/;
			attr = /([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;
			empty = makeMap("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr");
			block = makeMap("a,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video");
			inline = makeMap("abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var");
			closeSelf = makeMap("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");
			fillAttrs = makeMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");
			special = makeMap("script,style,source-code");

			HTMLParser = function HTMLParser(html, handler) {
				var index,
				    chars,
				    match,
				    stack = [],
				    last = html;
				stack.last = function () {
					return this[this.length - 1];
				};

				while (html) {
					chars = true;

					if (!stack.last() || !special[stack.last()]) {
						if (html.indexOf("<!--") == 0) {
							index = html.indexOf("-->");

							if (index >= 0) {
								if (handler.comment) handler.comment(html.substring(4, index));
								html = html.substring(index + 3);
								chars = false;
							}
						} else if (html.indexOf("</") == 0) {
								match = html.match(endTag);

								if (match) {
									html = html.substring(match[0].length);
									match[0].replace(endTag, parseEndTag);
									chars = false;
								}
							} else if (html.indexOf("<") == 0) {
									match = html.match(startTag);

									if (match) {
										html = html.substring(match[0].length);
										match[0].replace(startTag, parseStartTag);
										chars = false;
									}
								}

						if (chars) {
							index = html.indexOf("<");

							var text = index < 0 ? html : html.substring(0, index);
							html = index < 0 ? "" : html.substring(index);

							if (handler.chars) handler.chars(text);
						}
					} else {
						html = html.replace(new RegExp("([\\s\\S]*?)<\/" + stack.last() + "[^>]*>"), function (all, text) {
							text = text.replace(/<!--([\s\S]*?)-->|<!\[CDATA\[([\s\S]*?)]]>/g, "$1$2");
							if (handler.chars) handler.chars(text);

							return "";
						});

						parseEndTag("", stack.last());
					}

					if (html == last) throw "Parse Error: " + html;
					last = html;
				}

				parseEndTag();

				function parseStartTag(tag, tagName, rest, unary) {
					tagName = tagName.toLowerCase();

					if (block[tagName]) {
						while (stack.last() && inline[stack.last()]) {
							parseEndTag("", stack.last());
						}
					}

					if (closeSelf[tagName] && stack.last() == tagName) {
						parseEndTag("", tagName);
					}

					unary = empty[tagName] || !!unary;

					if (!unary) stack.push(tagName);

					if (handler.start) {
						var attrs = [];

						rest.replace(attr, function (match, name) {
							var value = arguments[2] ? arguments[2] : arguments[3] ? arguments[3] : arguments[4] ? arguments[4] : fillAttrs[name] ? name : "";

							attrs.push({
								name: name,
								value: value,
								escaped: value.replace(/(^|[^\\])"/g, '$1\\\"') });
						});

						if (handler.start) handler.start(tagName, attrs, unary);
					}
				}

				function parseEndTag(tag, tagName) {
					if (!tagName) var pos = 0;else for (var pos = stack.length - 1; pos >= 0; pos--) if (stack[pos] == tagName) break;

					if (pos >= 0) {
						for (var i = stack.length - 1; i >= pos; i--) if (handler.end) handler.end(stack[i]);

						stack.length = pos;
					}
				}
			};

			_export("HTMLParser", HTMLParser);
		}
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1cmVsaWEtZG9jcy9odG1sLXBhcnNlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7S0FDSSxRQUFRLEVBQ1gsTUFBTSxFQUNOLElBQUksRUFHRCxLQUFLLEVBR0wsS0FBSyxFQUdMLE1BQU0sRUFJTixTQUFTLEVBR1QsU0FBUyxFQUdULE9BQU8sRUFFQSxVQUFVOztBQXdJckIsVUFBUyxPQUFPLENBQUMsR0FBRyxFQUFFO0FBQ3JCLE1BQUksR0FBRyxHQUFHLEVBQUU7TUFBRSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNyQyxPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFDcEMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztBQUN0QixTQUFPLEdBQUcsQ0FBQztFQUNYOzs7O0FBcEtHLFdBQVEsR0FBRyxnSEFBZ0g7QUFDOUgsU0FBTSxHQUFHLDRCQUE0QjtBQUNyQyxPQUFJLEdBQUcsb0dBQW9HO0FBR3hHLFFBQUssR0FBRyxPQUFPLENBQUMsb0dBQW9HLENBQUM7QUFHckgsUUFBSyxHQUFHLE9BQU8sQ0FBQywrU0FBK1MsQ0FBQztBQUdoVSxTQUFNLEdBQUcsT0FBTyxDQUFDLGtNQUFrTSxDQUFDO0FBSXBOLFlBQVMsR0FBRyxPQUFPLENBQUMsa0RBQWtELENBQUM7QUFHdkUsWUFBUyxHQUFHLE9BQU8sQ0FBQyx3R0FBd0csQ0FBQztBQUc3SCxVQUFPLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDOztBQUV0QyxhQUFVLEdBQUcsU0FBYixVQUFVLENBQWEsSUFBSSxFQUFFLE9BQU8sRUFBRTtBQUNoRCxRQUFJLEtBQUs7UUFBRSxLQUFLO1FBQUUsS0FBSztRQUFFLEtBQUssR0FBRyxFQUFFO1FBQUUsSUFBSSxHQUFHLElBQUksQ0FBQztBQUNqRCxTQUFLLENBQUMsSUFB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Q29udGVudCI6WyIvLyBSZWd1bGFyIEV4cHJlc3Npb25zIGZvciBwYXJzaW5nIHRhZ3MgYW5kIGF0dHJpYnV0ZXNcbnZhciBzdGFydFRhZyA9IC9ePChbLUEtWmEtejAtOV9dKykoKD86XFxzK1thLXpBLVpfOl1bLWEtekEtWjAtOV86Ll0qKD86XFxzKj1cXHMqKD86KD86XCJbXlwiXSpcIil8KD86J1teJ10qJyl8W14+XFxzXSspKT8pKilcXHMqKFxcLz8pPi8sXG5cdGVuZFRhZyA9IC9ePFxcLyhbLUEtWmEtejAtOV9dKylbXj5dKj4vLFxuXHRhdHRyID0gLyhbYS16QS1aXzpdWy1hLXpBLVowLTlfOi5dKikoPzpcXHMqPVxccyooPzooPzpcIigoPzpcXFxcLnxbXlwiXSkqKVwiKXwoPzonKCg/OlxcXFwufFteJ10pKiknKXwoW14+XFxzXSspKSk/L2c7XG5cbi8vIEVtcHR5IEVsZW1lbnRzIC0gSFRNTCA1XG52YXIgZW1wdHkgPSBtYWtlTWFwKFwiYXJlYSxiYXNlLGJhc2Vmb250LGJyLGNvbCxmcmFtZSxocixpbWcsaW5wdXQsbGluayxtZXRhLHBhcmFtLGVtYmVkLGNvbW1hbmQsa2V5Z2VuLHNvdXJjZSx0cmFjayx3YnJcIik7XG5cbi8vIEJsb2NrIEVsZW1lbnRzIC0gSFRNTCA1XG52YXIgYmxvY2sgPSBtYWtlTWFwKFwiYSxhZGRyZXNzLGFydGljbGUsYXBwbGV0LGFzaWRlLGF1ZGlvLGJsb2NrcXVvdGUsYnV0dG9uLGNhbnZhcyxjZW50ZXIsZGQsZGVsLGRpcixkaXYsZGwsZHQsZmllbGRzZXQsZmlnY2FwdGlvbixmaWd1cmUsZm9vdGVyLGZvcm0sZnJhbWVzZXQsaDEsaDIsaDMsaDQsaDUsaDYsaGVhZGVyLGhncm91cCxocixpZnJhbWUsaW5zLGlzaW5kZXgsbGksbWFwLG1lbnUsbm9mcmFtZXMsbm9zY3JpcHQsb2JqZWN0LG9sLG91dHB1dCxwLHByZSxzZWN0aW9uLHNjcmlwdCx0YWJsZSx0Ym9keSx0ZCx0Zm9vdCx0aCx0aGVhZCx0cix1bCx2aWRlb1wiKTtcblxuLy8gSW5saW5lIEVsZW1lbnRzIC0gSFRNTCA1XG52YXIgaW5saW5lID0gbWFrZU1hcChcImFiYnIsYWNyb255bSxhcHBsZXQsYixiYXNlZm9udCxiZG8sYmlnLGJyLGJ1dHRvbixjaXRlLGNvZGUsZGVsLGRmbixlbSxmb250LGksaWZyYW1lLGltZyxpbnB1dCxpbnMsa2JkLGxhYmVsLG1hcCxvYmplY3QscSxzLHNhbXAsc2NyaXB0LHNlbGVjdCxzbWFsbCxzcGFuLHN0cmlrZSxzdHJvbmcsc3ViLHN1cCx0ZXh0YXJlYSx0dCx1LHZhclwiKTtcblxuLy8gRWxlbWVudHMgdGhhdCB5b3UgY2FuLCBpbnRlbnRpb25hbGx5LCBsZWF2ZSBvcGVuXG4vLyAoYW5kIHdoaWNoIGNsb3NlIHRoZW1zZWx2ZXMpXG52YXIgY2xvc2VTZWxmID0gbWFrZU1hcChcImNvbGdyb3VwLGRkLGR0LGxpLG9wdGlvbnMscCx0ZCx0Zm9vdCx0aCx0aGVhZCx0clwiKTtcblxuLy8gQXR0cmlidXRlcyB0aGF0IGhhdmUgdGhlaXIgdmFsdWVzIGZpbGxlZCBpbiBkaXNhYmxlZD1cImRpc2FibGVkXCJcbnZhciBmaWxsQXR0cnMgPSBtYWtlTWFwKFwiY2hlY2tlZCxjb21wYWN0LGRlY2xhcmUsZGVmZXIsZGlzYWJsZWQsaXNtYXAsbXVsdGlwbGUsbm9ocmVmLG5vcmVzaXplLG5vc2hhZGUsbm93cmFwLHJlYWRvbmx5LHNlbGVjdGVkXCIpO1xuXG4vLyBTcGVjaWFsIEVsZW1lbnRzIChjYW4gY29udGFpbiBhbnl0aGluZylcbnZhciBzcGVjaWFsID0gbWFrZU1hcChcInNjcmlwdCxzdHlsZSxzb3VyY2UtY29kZVwiKTtcblxuZXhwb3J0IGxldCBIVE1MUGFyc2VyID0gZnVuY3Rpb24gKGh0bWwsIGhhbmRsZXIpIHtcblx0dmFyIGluZGV4LCBjaGFycywgbWF0Y2gsIHN0YWNrID0gW10sIGxhc3QgPSBodG1sO1xuXHRzdGFjay5sYXN0ID0gZnVuY3Rpb24gKCkge1xuXHRcdHJldHVybiB0aGlzW3RoaXMubGVuZ3RoIC0gMV07XG5cdH07XG5cblx0d2hpbGUgKGh0bWwpIHtcblx0XHRjaGFycyA9IHRydWU7XG5cblx0XHQvLyBNYWtlIHN1cmUgd2UncmUgbm90IGluIGEgc2NyaXB0IG9yIHN0eWxlIGVsZW1lbnRcblx0XHRpZiAoIXN0YWNrLmxhc3QoKSB8fCAhc3BlY2lhbFtzdGFjay5sYXN0KCldKSB7XG5cblx0XHRcdC8vIENvbW1lbnRcblx0XHRcdGlmIChodG1sLmluZGV4T2YoXCI8IS0tXCIpID09IDApIHtcblx0XHRcdFx0aW5kZXggPSBodG1sLmluZGV4T2YoXCItLT5cIik7XG5cblx0XHRcdFx0aWYgKGluZGV4ID49IDApIHtcblx0XHRcdFx0XHRpZiAoaGFuZGxlci5jb21tZW50KVxuXHRcdFx0XHRcdFx0aGFuZGxlci5jb21tZW50KGh0bWwuc3Vic3RyaW5nKDQsIGluZGV4KSk7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwuc3Vic3RyaW5nKGluZGV4ICsgMyk7XG5cdFx0XHRcdFx0Y2hhcnMgPSBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGVuZCB0YWdcblx0XHRcdH0gZWxzZSBpZiAoaHRtbC5pbmRleE9mKFwiPC9cIikgPT0gMCkge1xuXHRcdFx0XHRtYXRjaCA9IGh0bWwubWF0Y2goZW5kVGFnKTtcblxuXHRcdFx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdFx0XHRodG1sID0gaHRtbC5zdWJzdHJpbmcobWF0Y2hbMF0ubGVuZ3RoKTtcblx0XHRcdFx0XHRtYXRjaFswXS5yZXBsYWNlKGVuZFRhZywgcGFyc2VFbmRUYWcpO1xuXHRcdFx0XHRcdGNoYXJzID0gZmFsc2U7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBzdGFydCB0YWdcblx0XHRcdH0gZWxzZSBpZiAoaHRtbC5pbmRleE9mKFwiPFwiKSA9PSAwKSB7XG5cdFx0XHRcdG1hdGNoID0gaHRtbC5tYXRjaChzdGFydFRhZyk7XG5cblx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0aHRtbCA9IGh0bWwuc3Vic3RyaW5nKG1hdGNoWzBdLmxlbmd0aCk7XG5cdFx0XHRcdFx0bWF0Y2hbMF0ucmVwbGFjZShzdGFydFRhZywgcGFyc2VTdGFydFRhZyk7XG5cdFx0XHRcdFx0Y2hhcnMgPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoY2hhcnMpIHtcblx0XHRcdFx0aW5kZXggPSBodG1sLmluZGV4T2YoXCI8XCIpO1xuXG5cdFx0XHRcdHZhciB0ZXh0ID0gaW5kZXggPCAwID8gaHRtbCA6IGh0bWwuc3Vic3RyaW5nKDAsIGluZGV4KTtcblx0XHRcdFx0aHRtbCA9IGluZGV4IDwgMCA/IFwiXCIgOiBodG1sLnN1YnN0cmluZyhpbmRleCk7XG5cblx0XHRcdFx0aWYgKGhhbmRsZXIuY2hhcnMpXG5cdFx0XHRcdFx0aGFuZGxlci5jaGFycyh0ZXh0KTtcblx0XHRcdH1cblxuXHRcdH0gZWxzZSB7XG5cdFx0XHRodG1sID0gaHRtbC5yZXBsYWNlKG5ldyBSZWdFeHAoXCIoW1xcXFxzXFxcXFNdKj8pPFxcL1wiICsgc3RhY2subGFzdCgpICsgXCJbXj5dKj5cIiksIGZ1bmN0aW9uIChhbGwsIHRleHQpIHtcblx0XHRcdFx0dGV4dCA9IHRleHQucmVwbGFjZSgvPCEtLShbXFxzXFxTXSo/KS0tPnw8IVxcW0NEQVRBXFxbKFtcXHNcXFNdKj8pXV0+L2csIFwiJDEkMlwiKTtcblx0XHRcdFx0aWYgKGhhbmRsZXIuY2hhcnMpXG5cdFx0XHRcdFx0aGFuZGxlci5jaGFycyh0ZXh0KTtcblxuXHRcdFx0XHRyZXR1cm4gXCJcIjtcblx0XHRcdH0pO1xuXG5cdFx0XHRwYXJzZUVuZFRhZyhcIlwiLCBzdGFjay5sYXN0KCkpO1xuXHRcdH1cblxuXHRcdGlmIChodG1sID09IGxhc3QpXG5cdFx0XHR0aHJvdyBcIlBhcnNlIEVycm9yOiBcIiArIGh0bWw7XG5cdFx0bGFzdCA9IGh0bWw7XG5cdH1cblxuXHQvLyBDbGVhbiB1cCBhbnkgcmVtYWluaW5nIHRhZ3Ncblx0cGFyc2VFbmRUYWcoKTtcblxuXHRmdW5jdGlvbiBwYXJzZVN0YXJ0VGFnKHRhZywgdGFnTmFtZSwgcmVzdCwgdW5hcnkpIHtcblx0XHR0YWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXG5cdFx0aWYgKGJsb2NrW3RhZ05hbWVdKSB7XG5cdFx0XHR3aGlsZSAoc3RhY2subGFzdCgpICYmIGlubGluZVtzdGFjay5sYXN0KCldKSB7XG5cdFx0XHRcdHBhcnNlRW5kVGFnKFwiXCIsIHN0YWNrLmxhc3QoKSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGNsb3NlU2VsZlt0YWdOYW1lXSAmJiBzdGFjay5sYXN0KCkgPT0gdGFnTmFtZSkge1xuXHRcdFx0cGFyc2VFbmRUYWcoXCJcIiwgdGFnTmFtZSk7XG5cdFx0fVxuXG5cdFx0dW5hcnkgPSBlbXB0eVt0YWdOYW1lXSB8fCAhIXVuYXJ5O1xuXG5cdFx0aWYgKCF1bmFyeSlcblx0XHRcdHN0YWNrLnB1c2godGFnTmFtZSk7XG5cblx0XHRpZiAoaGFuZGxlci5zdGFydCkge1xuXHRcdFx0dmFyIGF0dHJzID0gW107XG5cblx0XHRcdHJlc3QucmVwbGFjZShhdHRyLCBmdW5jdGlvbiAobWF0Y2gsIG5hbWUpIHtcblx0XHRcdFx0dmFyIHZhbHVlID0gYXJndW1lbnRzWzJdID8gYXJndW1lbnRzWzJdIDpcblx0XHRcdFx0XHRhcmd1bWVudHNbM10gPyBhcmd1bWVudHNbM10gOlxuXHRcdFx0XHRcdGFyZ3VtZW50c1s0XSA/IGFyZ3VtZW50c1s0XSA6XG5cdFx0XHRcdFx0ZmlsbEF0dHJzW25hbWVdID8gbmFtZSA6IFwiXCI7XG5cblx0XHRcdFx0YXR0cnMucHVzaCh7XG5cdFx0XHRcdFx0bmFtZTogbmFtZSxcblx0XHRcdFx0XHR2YWx1ZTogdmFsdWUsXG5cdFx0XHRcdFx0ZXNjYXBlZDogdmFsdWUucmVwbGFjZSgvKF58W15cXFxcXSlcIi9nLCAnJDFcXFxcXFxcIicpIC8vXCJcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKGhhbmRsZXIuc3RhcnQpXG5cdFx0XHRcdGhhbmRsZXIuc3RhcnQodGFnTmFtZSwgYXR0cnMsIHVuYXJ5KTtcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBwYXJzZUVuZFRhZyh0YWcsIHRhZ05hbWUpIHtcblx0XHQvLyBJZiBubyB0YWcgbmFtZSBpcyBwcm92aWRlZCwgY2xlYW4gc2hvcFxuXHRcdGlmICghdGFnTmFtZSlcblx0XHRcdHZhciBwb3MgPSAwO1xuXG5cdFx0XHQvLyBGaW5kIHRoZSBjbG9zZXN0IG9wZW5lZCB0YWcgb2YgdGhlIHNhbWUgdHlwZVxuXHRcdGVsc2Vcblx0XHRcdGZvciAodmFyIHBvcyA9IHN0YWNrLmxlbmd0aCAtIDE7IHBvcyA+PSAwOyBwb3MtLSlcblx0XHRcdFx0aWYgKHN0YWNrW3Bvc10gPT0gdGFnTmFtZSlcblx0XHRcdFx0XHRicmVhaztcblxuXHRcdGlmIChwb3MgPj0gMCkge1xuXHRcdFx0Ly8gQ2xvc2UgYWxsIHRoZSBvcGVuIGVsZW1lbnRzLCB1cCB0aGUgc3RhY2tcblx0XHRcdGZvciAodmFyIGkgPSBzdGFjay5sZW5ndGggLSAxOyBpID49IHBvczsgaS0tKVxuXHRcdFx0XHRpZiAoaGFuZGxlci5lbmQpXG5cdFx0XHRcdFx0aGFuZGxlci5lbmQoc3RhY2tbaV0pO1xuXG5cdFx0XHQvLyBSZW1vdmUgdGhlIG9wZW4gZWxlbWVudHMgZnJvbSB0aGUgc3RhY2tcblx0XHRcdHN0YWNrLmxlbmd0aCA9IHBvcztcblx0XHR9XG5cdH1cbn07XG5cbmZ1bmN0aW9uIG1ha2VNYXAoc3RyKSB7XG5cdHZhciBvYmogPSB7fSwgaXRlbXMgPSBzdHIuc3BsaXQoXCIsXCIpO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKVxuXHRcdG9ialtpdGVtc1tpXV0gPSB0cnVlO1xuXHRyZXR1cm4gb2JqO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
