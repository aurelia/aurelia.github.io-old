<section class="article">
  <header>
    <h1>Aurelia CLI Bundler</h1>
    <h2>In depth guide to the integrated Aurelia CLI Bundler.</h2>
  </header>

  <article class="markdown">
    <section><h2 id="introduction">Introduction</h2><p>This part of the documentation is only relevant if you are using the Aurelia CLI Bundler. If you're using Webpack then the Webpack chapter is what you need.</p>
</section>
<section><h2 id="aspnet-core">ASP.NET Core</h2><p>If you would like to use ASP.NET Core, first begin by using Visual Studio to create your ASP.NET Core project. Select whatever options make the most sense based on your .NET project plans. After you have created the project, open a command line and change directory into your web project's project folder. This is the folder that contains the <code>.xproj</code> file. From within this folder, you can execute the following command <code>au new --here</code> which will setup Aurelia &quot;here&quot; inside this project folder. You will be prompted to choose the platform you want. Simply select &quot;ASP.NET Core&quot;. Follow the prompts for the rest of the process, just like above.</p>
<div class="info"><div class="icon"> <i></i> </div><p>
Since Aurelia-CLI should be in charge of building your client side code, make sure before running the <code>new</code> command from <strong>Aurelia-CLI</strong> you add <code>&lt;typescriptcompileblocked&gt;true</code> to your .xproj file inside the first <code>&lt;propertygroup&gt;</code> you find to stop Visual Studio from compiling the <code>.ts</code> files in your project. If you build your solution before doing this, Visual Studio will compile your <code>.ts</code> files breaking some of the <strong>Aurelia-CLI</strong> commands.</p>
</div>
<p>When developing an ASP.NET Core application you will want to set the <code>ASPNETCORE_ENVIRONMENT</code> environment variable. Detailed instructions can be found on the 
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments#setting-the-environment" target="_blank">Microsoft Docs</a>
.</p>
</section>
<section><h2 id="deploying-your-app">Deploying Your App</h2><p>Run the following build command:</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  au build <span class="token operator">--</span>env prod
  
</code></pre></source-code></code-listing>
<p>Then copy the file <code>index.html</code> and the folder <code>/scripts</code>  to the main deployment folder on your server.</p>
</section>
<section><h2 id="unit-testing">Unit Testing</h2><p>If you selected a project setup that includes unit tests, you can run your tests with <code>au test</code>. If you would like to adopt a tdd-based workflow, writing code and tests with continual test evaluation, you can use the <code>--watch</code> flag. For example: <code>au test --watch</code>.</p>
</section>
<section><h2 id="build-revisions">Build Revisions</h2><p>To create builds with revision numbers, you must set <code>rev</code> to be <code>true</code> under the build options. This will cause a unique revision number to be added to the bundled files. For example:</p>
<code-listing><source-code lang="javascript"><pre class="language-javascript"><code>
  <span class="token string">"options"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"minify"</span><span class="token punctuation">:</span> <span class="token string">"stage &amp; prod"</span><span class="token punctuation">,</span>
    <span class="token string">"sourcemaps"</span><span class="token punctuation">:</span> <span class="token string">"dev &amp; stage"</span><span class="token punctuation">,</span>
    <span class="token string">"rev"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<p>You are also able to set specific flags so that build revisions only take place while staging or in production. For example:</p>
<code-listing><source-code lang="javascript"><pre class="language-javascript"><code>
  <span class="token string">"options"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"minify"</span><span class="token punctuation">:</span> <span class="token string">"stage &amp; prod"</span><span class="token punctuation">,</span>
    <span class="token string">"sourcemaps"</span><span class="token punctuation">:</span> <span class="token string">"dev &amp; stage"</span><span class="token punctuation">,</span>
    <span class="token string">"rev"</span><span class="token punctuation">:</span> <span class="token string">"stage &amp; prod"</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<p>Now, if you were to run <code>au build --env prod</code>, the output would contain build revisions, while <code>au build --env dev</code> would not. Setting the build revisions to only compile while in production can help the development process, since it keeps your workspace clean of various build revisions.</p>
<h3>Modifying The Index File</h3>
<p>In order for your <code>index.html</code> file to be updated to load up the correct revisioned bundle, you must ensure that the <code>&quot;index&quot;</code> property located in <code>build/targets</code> section is correctly pointing to the <code>index.html</code> (or starting page) for your project. For example:</p>
<code-listing><source-code lang="javascript"><pre class="language-javascript"><code>
  <span class="token string">"build"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"web"</span><span class="token punctuation">,</span>
        <span class="token string">"displayName"</span><span class="token punctuation">:</span> <span class="token string">"Web"</span><span class="token punctuation">,</span>
        <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"scripts"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
</section>
<section><h2 id="bundling-your-project">Bundling Your Project</h2><p>By default, the Aurelia CLI creates two bundles, an <code>app-bundle.js</code>, and a <code>vendor-bundle.js</code>. An example of the default <code>app-bundle.js</code> looks like this:</p>
<code-listing><source-code lang="javascript"><pre class="language-javascript"><code>
  <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"app-bundle.js"</span><span class="token punctuation">,</span>
    <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"[**/*.js]"</span><span class="token punctuation">,</span>
      <span class="token string">"**/*.{css,html}"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<p>In this setup, we've named the bundle <code>app-bundle.js</code>, and have defined what's included by setting the <code>source</code> property to be an array of patterns that match to file paths (the patterns are using glob patterns, 
<a href="https://github.com/isaacs/minimatch" target="_blank">minimatch</a>
 to be specific, to find files that match).<br />
Optionally, you can define an <code>exclude</code> list by setting the <code>source</code> property to be an object containing both an <code>include</code> and <code>exclude</code> array of patterns. This is helpful when you're trying to define multiple bundles from your source code.</p>
<code-listing><source-code lang="javascript"><pre class="language-javascript"><code>
  <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"app-bundle.js"</span><span class="token punctuation">,</span>
    <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"include"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"[**/*.js]"</span><span class="token punctuation">,</span>
        <span class="token string">"**/*.{css,html}"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"exclude"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"**/sub-module/**/*"</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"sub-module-bundle.js"</span><span class="token punctuation">,</span>
    <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"**/sub-module/**/*"</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
</section>
<section><h2 id="adding-client-libraries-to-your-project">Adding Client Libraries to Your Project</h2><p>The CLI provides two commands to help you add 3rd party client libraries, <code>au install &lt;library&gt;</code> and <code>au import &lt;library&gt;</code>. The <code>install</code> command will download, install and add the library to the configuration file <code>aurelia_project/aurelia.json</code>. The <code>import</code> command will add a library that you've previously installed with npm to the configuration file. Finally, both commands will give you instructions on how to access the library from your code.</p>
<h3>Manual configuration</h3>
<p>Unfortunately, not all 3rd party libraries can be successfully configured automatically by the <code>install</code> and <code>import</code> commands. In order the remedy this by manual configuration, open the <code>aurelia_project/aurelia.json</code> file and scroll down to the <code>build.bundles</code> section. You'll need to add the library into one of your bundle's <code>dependencies</code> sections.</p>
<p>Below is some guidance for how to manually configure several different common 3rd party library scenarios:</p>
<h3>A Single-File Module</h3>
<p>If the library you have installed is a single CommonJS or AMD file, you can add an entry similar to the following to the dependencies of your bundle:</p>
<code-listing heading="A Single File Module Dependency">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"library-name"</span><span class="token punctuation">,</span>
        <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/library-name/dist/library-name"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<ul>
<li><code>name</code> - This is the name of the library as you will import it in your JavaScript or TypeScript code.</li>
<li><code>path</code> - This is a path to the single module file itself. This path is relative to your application's <code>src</code> folder. Also, you should not include the file extension. <code>.js</code> will be appended automatically.</li>
</ul>
<p>If the <code>main</code> field of the library's <code>package.json</code> points to the single file that you need to bundle, then you can opt for a simplified configuration by just adding the package name to your dependencies directly:</p>
<code-listing heading="A Single File Module Dependency via Main">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">"library-name"</span>
    <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<h3>A CommonJS Package</h3>
<p>Many modules installed through NPM are packages made up of multiple source files. Configuring a library like this is a bit different than the single-file scenario above. Here's an example configuration for a multi-file package:</p>
<code-listing heading="A CommonJS Package Dependency">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-testing"</span><span class="token punctuation">,</span>
        <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/aurelia-testing/dist/amd"</span><span class="token punctuation">,</span>
        <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-testing"</span><span class="token punctuation">,</span>
        <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token string">"dev"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<ul>
<li><code>name</code> - This is the name of the library as you will import it in your JavaScript or TypeScript code.</li>
<li><code>path</code> - This is a path to the folder where the package's source is located. This path is relative to your application's <code>src</code> folder.</li>
<li><code>main</code> - This is the main module (entry point) of the package, relative to the <code>path</code>. You should not include the file extension. <code>.js</code> will be appended automatically. Set <code>main</code> to <code>false</code> when the package does not have a main file.</li>
</ul>
<div class="info"><div class="icon"> <i></i> </div><h4>Environment-Specific Dependencies</h4><p>
We've also shown how to use the <code>env</code> setting on a dependency. This can be used on any dependency in the bundle to indicate what environment builds the dependency should be included in. By default, dependencies are included in all builds. The example above shows how to include the library only in builds targeting the &quot;dev&quot; environment. You can also specify multiple environments like <code>dev &amp; stage</code>.</p>
</div>
<h3>A Legacy Library</h3>
<p>Libraries that predate module systems can be a pain because they often rely on global scripts which must be loaded before the library. These libraries also add their own global variables. An example of one such library is 
<a href="http://getbootstrap.com/css/" target="_blank">bootstrap</a>
. Let's take a look at how to handle a legacy library like that.</p>
<code-listing heading="A Legacy Library Dependency">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"jquery"</span><span class="token punctuation">,</span>
        <span class="token string">"path"</span><span class="token punctuation">:</span><span class="token string">"../node_modules/jquery/dist"</span><span class="token punctuation">,</span>
        <span class="token string">"main"</span><span class="token punctuation">:</span><span class="token string">"jquery.min"</span><span class="token punctuation">,</span>
        <span class="token string">"exports"</span><span class="token punctuation">:</span> <span class="token string">"$"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/bootstrap/dist"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"js/bootstrap.min"</span><span class="token punctuation">,</span>
          <span class="token string">"deps"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<ul>
<li><code>name</code> - This is the name of the library as you will import it in your JavaScript or TypeScript code.</li>
<li><code>path</code> - This is a path to the folder where the package's source is located. This path is relative to your application's <code>src</code> folder.</li>
<li><code>main</code> - This is the main module (entry point) of the package, relative to the <code>path</code>. You should not include the file extension. <code>.js</code> will be appended automatically.  Set <code>main</code> to <code>false</code> when the package does not have a main file.</li>
<li><code>deps</code> - This is an array of dependencies which must be loaded and available before the legacy library can be evaluated.</li>
<li><code>exports</code> - This is the name of the global variable that should be used as the exported value of the module.</li>
</ul>
<p>Notice first that we've included &quot;jquery&quot; as one of our dependencies, <em>and specifically at the beginning of the dependency list</em>.<br />
We are using the <code>exports</code> property to export the jQuery object since jQuery plugin, like Bootstrap, attach their APIs to the jQuery object itself.  (This could be any global variable, though.)  Finally, below that we configure <code>bootstrap</code>. The first three properties are the same as in our package example above. However, now we have a <code>deps</code> list. We've included <code>jquery</code> since Bootstrap needs it to be present before it can load.</p>
<h3>A Library with Additional Resources</h3>
<p>The Bootstrap example above results in the bundling of the JavaScript portions of the library. But, as you probably know, Bootstrap is mostly about CSS. The CSS files distributed with Bootstrap aren't traceable through the module system so this still doesn't result in the Bootstrap CSS being bundled. Here's how we solve that problem:</p>
<code-listing heading="A Library with Additional Resources">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"jquery"</span><span class="token punctuation">,</span>
        <span class="token string">"path"</span><span class="token punctuation">:</span><span class="token string">"../node_modules/jquery/dist"</span><span class="token punctuation">,</span>
        <span class="token string">"main"</span><span class="token punctuation">:</span><span class="token string">"jquery.min"</span><span class="token punctuation">,</span>
        <span class="token string">"exports"</span><span class="token punctuation">:</span> <span class="token string">"$"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/bootstrap/dist"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"js/bootstrap.min"</span><span class="token punctuation">,</span>
          <span class="token string">"deps"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"resources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">"css/bootstrap.css"</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<p>Notice that we've added a <code>resources</code> array. Here we can provide a list of additional files to be included with the bundle. These files are relative to the <code>path</code> designated above and must include the file extension. You can also use glob patterns in place of exact file names.</p>
<p>The final step to make Bootstrap work is to copy the necessary font files to the <code>bootstrap/fonts</code> folder, which by default is where Bootstrap will look for the font files. To do this, we should declare these files in the <code>copyFiles</code> property, after the <code>bundles</code> property.</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"bundles"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token string">"copyFiles"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"node_modules/bootstrap/dist/fonts/glyphicons-halflings-regular.woff2"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap/fonts"</span><span class="token punctuation">,</span>
      <span class="token string">"node_modules/bootstrap/dist/fonts/glyphicons-halflings-regular.woff"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap/fonts"</span><span class="token punctuation">,</span>
      <span class="token string">"node_modules/bootstrap/dist/fonts/glyphicons-halflings-regular.ttf"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap/fonts"</span>
    <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<p>Now, the font files will be copied to the <code>bootstrap/fonts</code> folder when building the application.</p>
<div class="info"><div class="icon"> <i></i> </div><h4>Setup for copying files</h4><p>
The <code>copyFiles</code> works as a 'from':'to' setup, where 'from' is the location of the file you want to copy, and 'to' is the destination folder. Both paths are relative to project folder. The sintax is:</p>
</div>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"bundles"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token string">"copyFiles"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token constant">FILE_YOU_WANT_TO_COPY_BASED_ON_PROJECT_FOLDER</span><span class="token punctuation">:</span> <span class="token constant">DESTINATION_FOLDER_BASED_ON_PROJECT_FOLDER</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<blockquote>
<p>If you run the application providing the <code>--watch</code> flag, the files will be recopied when changed.</p>
</blockquote>
<div class="info"><div class="icon"> <i></i> </div><p>
Remember that CSS bundled in this way is bundled as a text resource designed to be required in your view. To load the Bootstrap css file in a view, use <code>&lt;require from=&quot;bootstrap/css/bootstrap.css&quot;&gt;&lt;/require&gt;</code>. Notice that the module name derives from combining the <code>name</code> property with the resource.</p>
</div>
<h3>A Very Stubborn Legacy Library</h3>
<p>Sometimes you can't get a library to work with the module loading system. That's ok. You can still include it in the bundle, using traditional concatenation techniques. In fact, this is how the CLI bundles up the loader and promise polyfills. These items don't go into the <code>dependencies</code> section but instead go into the <code>prepend</code> section. This is because they aren't module dependencies. They also aren't relative to the <code>src</code>, but relative to the project folder. Using the <code>prepend</code> section causes the scripts to be prepended to the beginning of the bundle, using normal script concatenation techniques. Here's a full vendor bundle example, showing this and the rest of the techniques listed above.</p>
<code-listing heading="A Sample Bundle">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"vendor-bundle.js"</span><span class="token punctuation">,</span>
      <span class="token string">"prepend"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"node_modules/bluebird/js/browser/bluebird.core.js"</span><span class="token punctuation">,</span>
        <span class="token string">"scripts/require.js"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"aurelia-binding"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-bootstrapper"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-dependency-injection"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-event-aggregator"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-framework"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-history"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-history-browser"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-loader"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-loader-default"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-logging"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-logging-console"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-metadata"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-pal"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-pal-browser"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-path"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-polyfills"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-route-recognizer"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-router"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-task-queue"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-templating"</span><span class="token punctuation">,</span>
        <span class="token string">"aurelia-templating-binding"</span><span class="token punctuation">,</span>
        <span class="token string">"nprogress"</span><span class="token punctuation">,</span>
        <span class="token string">"jquery"</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"bootstrap"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/bootstrap/dist"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"js/bootstrap.min"</span><span class="token punctuation">,</span>
          <span class="token string">"deps"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"exports"</span><span class="token punctuation">:</span> <span class="token string">"$"</span><span class="token punctuation">,</span>
          <span class="token string">"resources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">"css/bootstrap.css"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../scripts/text"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-templating-resources"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/aurelia-templating-resources/dist/amd"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-templating-resources"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-templating-router"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/aurelia-templating-router/dist/amd"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-templating-router"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-testing"</span><span class="token punctuation">,</span>
          <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/aurelia-testing/dist/amd"</span><span class="token punctuation">,</span>
          <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"aurelia-testing"</span><span class="token punctuation">,</span>
          <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token string">"dev"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  </code></pre></source-code>
</code-listing>
<p>You may want to prepend or append scripts based on the active environment. That's entirely possible through the following syntax:</p>
<code-listing heading="Prepend/append per environment">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"vendor-bundle.js"</span><span class="token punctuation">,</span>
      <span class="token string">"prepend"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
		 <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"scripts/require.js"</span><span class="token punctuation">,</span>
		 <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token string">"stage &amp; prod"</span>
	  <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  </code></pre></source-code>
</code-listing>
<p>The above configuration would prepend the <code>scripts/require.js</code> file only for the <code>stage</code> and <code>prod</code> environments.</p>
<h3>A Very Stubborn Legacy Library With Plugins</h3>
<p>Some legacy libraries may support plugins which you also want included in your bundle. In some cases these plugins depend on a global object defined by the main library, so it is important that the plugins exist later in the bundle than the main library scripts. These plugins can go in the <code>append</code> section, which works exactly the same as the <code>prepend</code> section but the scripts are appended to the end of the bundle, after all other items.  Like the <code>prepend</code> section all items are relative to the project folder, not the <code>src</code>.</p>
<h3>A note on NPM's scoped packages</h3>
<p>The CLI treats 
<a href="https://docs.npmjs.com/misc/scope" target="_blank">scoped packages</a>
 in the same way as unscoped ones, you just need to remember that the scope is always part of its name.</p>
<p>So, for example, if you need to consume a scoped package in a CLI project, you need the following in your <code>aurelia.json</code>:</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"@scope/packagename"</span><span class="token punctuation">,</span>
      <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/@scope/packagename/dist/amd"</span><span class="token punctuation">,</span>
      <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"packagename"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  
</code></pre></source-code></code-listing>
<p>Your imports must be scoped too:</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> SomeClass <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@scope/packagename'</span><span class="token punctuation">;</span>
  
</code></pre></source-code></code-listing>
<p>And this is an example of loading a <code>@scope/packagename</code> plugin during app startup:</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  aurelia<span class="token punctuation">.</span>use<span class="token punctuation">.</span><span class="token function">standardConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'@scope/packagename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</code></pre></source-code></code-listing>
<h3>Reference packages outside of the node_modules folder</h3>
<p>It is possible to use packages outside of the node_modules folder. The only difference is that you need to define what the <code>packageRoot</code> is. In <code>aurelia.json</code>, you can define a package that lives outside of the node_modules folder as follows:</p>
<code-listing heading="Package outside of node_modules">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"my-standalone-folder"</span><span class="token punctuation">,</span>
      <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"../my-standalone-folder/dist/amd"</span><span class="token punctuation">,</span>
      <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span>
      <span class="token string">"packageRoot"</span><span class="token punctuation">:</span> <span class="token string">"../my-standalone-folder"</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<p>The <code>packageRoot</code> is the root folder of the package. This is often the folder which contains the <code>package.json</code> file of the package.</p>
</section>
<section><h2 id="configuring-the-loader">Configuring the Loader</h2><p>You can configure the loader by adding a <code>config</code> key to <code>build.loader</code> with the options you want to add. For instance, if you want to increase the timeout for requirejs, you would do this:</p>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"build"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"loader"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"require"</span><span class="token punctuation">,</span>
          <span class="token string">"configTarget"</span><span class="token punctuation">:</span> <span class="token string">"vendor-bundle.js"</span><span class="token punctuation">,</span>
          <span class="token string">"includeBundleMetadataInConfig"</span><span class="token punctuation">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>
          <span class="token string">"config"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">"waitSeconds"</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<p><strong>Setting the baseUrl</strong></p>
<p>Sometimes you may want to keep the scripts folder somewhere other than the default location, or move the index.html file a few folders up from the project root. In that case it is possible to set the <code>baseUrl</code> property so that the build system uses the correct paths and that bundles get loaded correctly in the browser. The <code>baseUrl</code> property should be set in both the <code>platform</code> object as well as the <code>build.targets</code> object:</p>
<code-listing heading="baseUrl">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"web"</span><span class="token punctuation">,</span>
        <span class="token string">"displayName"</span><span class="token punctuation">:</span> <span class="token string">"Web"</span><span class="token punctuation">,</span>
        <span class="token string">"output"</span><span class="token punctuation">:</span> <span class="token string">"some/dir/scripts"</span><span class="token punctuation">,</span>
        <span class="token string">"index"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>
        <span class="token string">"baseUrl"</span><span class="token punctuation">:</span> <span class="token string">"some/dir/scripts"</span>
      <span class="token punctuation">}</span>
  </code></pre></source-code>
</code-listing>
<p>The script tag for the bundle in <code>index.html</code> file needs to point to the modified location of the scripts folder as well: <code>&lt;script src=&quot;some/dir/scripts/vendor-bundle.js&quot; data-main=&quot;aurelia-bootstrapper&quot;&gt;&lt;/script&gt;</code></p>
</section>
<section><h2 id="styling-your-application">Styling your Application</h2><p>There are many ways to style components in Aurelia. The CLI sets up your project to only process styles inside your application's <code>src</code> folder. Those styles can then be imported into a view using Aurelia's <code>require</code> element.</p>
<ul>
<li>If you aren't using any CSS preprocessor, you write css and then simply require it in the view like this:</li>
</ul>
<code-listing heading="Requiring styles.css">
  <source-code lang="HTML"><pre class="language-markup"><code>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>require</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./styles.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>require</span><span class="token punctuation">></span></span>
  </code></pre></source-code>
</code-listing>
<ul>
<li>For projects that use a CSS preprocessor (chosen from the cli setup questions):
<ul>
<li>Write your styles in the format you chose (styl, sass, less ...).</li>
<li>Require the style by <code>[filename].css</code> instead of <code>[filename].[extension]</code>. This is because
your style file is transpiled into a module that encodes the resulting <code>css</code> file extension.</li>
</ul>
</li>
</ul>
<code-listing heading="Requiring main.sass">
  <source-code lang="HTML"><pre class="language-markup"><code>
    &lt;require from ="./main.css"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>require</span><span class="token punctuation">></span></span>
  </code></pre></source-code>
</code-listing>
<p>Bear in mind that you can always configure things any way you want by modifying the tasks in the <code>aurelia_project/tasks</code> folder.
For styling purposes, you can modify the <code>process-css.js</code> file.</p>
</section>
<section><h2 id="updating-a-single-library">Updating A Single Library</h2><p>To update a single library use the command <code>npm install library-name</code> where library-name is the library that you wish to update.</p>
</section>
<section><h2 id="updating-multiple-libraries">Updating Multiple Libraries</h2><ul>
<li>Add the following section to the project's package.json file</li>
</ul>
<code-listing><source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"au-update"</span><span class="token punctuation">:</span> "npm install aurelia<span class="token operator">-</span>binding@latest aurelia<span class="token operator">-</span>bootstrapper@latest <span class="token operator">...</span>
      <span class="token punctuation">}</span>
  
</code></pre></source-code></code-listing>
<ul>
<li>List the libraries on a single line separated by a space.</li>
<li>Include all of the libraries from the dependencies section of aurelia.json that you want to update.</li>
<li>Use the command <code>npm run au-update</code> to update all of the libraries in the au-update list above.</li>
</ul>
</section>
<section><h2 id="javascript-minification">Javascript Minification</h2><p>The CLI will minify Javascript out of the box for the staging and production environments:</p>
<code-listing heading="Default minification settings">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"options"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"minify"</span><span class="token punctuation">:</span> <span class="token string">"stage &amp; prod"</span><span class="token punctuation">,</span>
      <span class="token string">"sourcemaps"</span><span class="token punctuation">:</span> <span class="token string">"dev &amp; stage"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  </code></pre></source-code>
</code-listing>
<p>These options can be found in the <code>&quot;build&quot;.&quot;options&quot;</code> section of <code>aurelia.json</code>. If you wish to specify the options that are used in the minification process, then replace <code>&quot;minify&quot;: &quot;stage &amp; prod&quot;</code> with:</p>
<code-listing heading="Default minification settings">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"minify"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string">"default"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"indent_level"</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">"stage &amp; prod"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"max-line-len"</span><span class="token punctuation">:</span> <span class="token number">100000</span>
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  </code></pre></source-code>
</code-listing>
<p>The Aurelia-CLI uses 
<a href="https://github.com/mishoo/UglifyJS2" target="_blank">UglifyJS2</a>
 for minification, so any option that UglifyJS2 supports is also supported by the Aurelia-CLI. With the above configuration, minification will occur for the <code>stage</code> and <code>prod</code> environments, but not for the <code>dev</code> environment. For the <code>stage</code> and <code>prod</code> environments, both the <code>indent_level</code> as well as the <code>max-line-len</code> option are passed to the minifier. The <code>default</code> key is optional, but allows you to reduce code duplication when multiple environments have similar options.</p>
</section>
<section><h2 id="loader-plugins">Loader plugins</h2><p>Since RequireJS and SystemJS support the notion of loader plugins, the Aurelia CLI allows you to use these in your application. The configuration of these plugins can be found in <code>aurelia.json</code> in the <code>build.loader</code> object:</p>
<code-listing heading="Loader plugins">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"loader"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"require"</span><span class="token punctuation">,</span>
      <span class="token string">"configTarget"</span><span class="token punctuation">:</span> <span class="token string">"vendor-bundle.js"</span><span class="token punctuation">,</span>
      <span class="token string">"includeBundleMetadataInConfig"</span><span class="token punctuation">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>
      <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">".html"</span><span class="token punctuation">,</span>
            <span class="token string">".css"</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"stub"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">]</span>
  </code></pre></source-code>
</code-listing>
<p>The plugins array is the collection of all loader plugins that your application needs. By default this is only the <code>text</code> plugin, but you can easily add others.</p>
<p>The <code>extensions</code> array tells the Aurelia CLI Bundler for which files to use the plugin. That allows the bundler to bundle <code>.html</code> and <code>.css</code> files.</p>
<p>The stub property is an interesting one. If it's set to <code>true</code> then the loader plugin won't be included into the bundle, and will result in the bundle being smaller. However, you're not able to use this loader plugin at runtime. So if you were to fetch HTML files using the <code>html</code> plugin, and those files aren't in the bundle, then that would not work as the loader would try to use the <code>html</code> plugin. When the <code>stub</code> property is set to <code>true</code> that plugin wouldn't be available and the loader would throw an error. A solution would be to set <code>stub</code> to <code>false</code>, but it's  better to include the files that you're trying to fetch in the bundle.</p>
<p>Adding new plugins is usually a three step process. First you have to specify the plugin in the <code>loader.plugins</code> array.  Then you have to specify the loader plugin as a <code>dependency</code> in one of your bundle configurations. Sometimes the name of the loader plugin is not how you would like to use it. Then you could add an entry to the <code>paths</code> object in <code>aurelia.json</code> to specify a new name:</p>
<code-listing heading="Path mapping for loader plugin">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"paths"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"root"</span><span class="token punctuation">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
    <span class="token string">"resources"</span><span class="token punctuation">:</span> <span class="token string">"resources"</span><span class="token punctuation">,</span>
    <span class="token string">"elements"</span><span class="token punctuation">:</span> <span class="token string">"resources/elements"</span><span class="token punctuation">,</span>
    <span class="token string">"attributes"</span><span class="token punctuation">:</span> <span class="token string">"resources/attributes"</span><span class="token punctuation">,</span>
    <span class="token string">"valueConverters"</span><span class="token punctuation">:</span> <span class="token string">"resources/value-converters"</span><span class="token punctuation">,</span>
    <span class="token string">"bindingBehaviors"</span><span class="token punctuation">:</span> <span class="token string">"resources/binding-behaviors"</span><span class="token punctuation">,</span>
    <span class="token string">"json"</span><span class="token punctuation">:</span> <span class="token string">"../node_modules/requirejs-json/json"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  </code></pre></source-code>
</code-listing>
</section>
<section><h2 id="path-mappings">Path mappings</h2><p>Do you have import statements that look like <code>import {Customer} from '../../../../models/customer';</code> ?</p>
<p>Consider creating a path mapping for the <code>models</code> folder, so that you can do: <code>import {Customer} from 'models/customer';</code>.</p>
<p>Here's how to do it. Open up <code>aurelia.json</code> and in the <code>paths</code> object do the following:</p>
<code-listing heading="Path mappings">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
  <span class="token string">"paths"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"root"</span><span class="token punctuation">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span>
    <span class="token string">"resources"</span><span class="token punctuation">:</span> <span class="token string">"resources"</span><span class="token punctuation">,</span>
    <span class="token string">"elements"</span><span class="token punctuation">:</span> <span class="token string">"resources/elements"</span><span class="token punctuation">,</span>
    <span class="token string">"attributes"</span><span class="token punctuation">:</span> <span class="token string">"resources/attributes"</span><span class="token punctuation">,</span>
    <span class="token string">"valueConverters"</span><span class="token punctuation">:</span> <span class="token string">"resources/value-converters"</span><span class="token punctuation">,</span>
    <span class="token string">"bindingBehaviors"</span><span class="token punctuation">:</span> <span class="token string">"resources/binding-behaviors"</span><span class="token punctuation">,</span>
    <span class="token string">"models"</span><span class="token punctuation">:</span> <span class="token string">"models"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  </code></pre></source-code>
</code-listing>
<p>That should make it work at runtime, but if you use Typescript it's going to tell you that it can't find <code>models/customer</code>. To fix that, open up <code>tsconfig.json</code> and in the <code>compilerOptions</code> add a <code>paths</code> and <code>baseUrl</code> property:</p>
<code-listing heading="tsconfig.json path mappings">
  <source-code lang="JavaScript"><pre class="language-javascript"><code>
    <span class="token string">"paths"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"models/*"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"src/models/*"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"baseUrl"</span><span class="token punctuation">:</span> <span class="token string">"."</span>
  </code></pre></source-code>
</code-listing>
<p>You might have to restart your editor to see the effect of these changes.
</library></library></propertygroup></typescriptcompileblocked></p>
</section>

  </article>
</section>
