{"name":"Aurelia Authentication Using Firebase","description":"As a recovering full-stack developer who went the specialised front-end route a few years ago, the one aspect I have always hated about building any feature-rich web application is authentication. Thankfully a lot of convenient options have popped up over the last couple of years like Auth0 [https://auth0.com/].","author":{"name":"AureliaEffect"},"links":{"static":"blog/2016/11/23/aurelia-authentication-using-firebase","html":"blog/2016/11/23/aurelia-authentication-using-firebase/index.html","fragment":"blog/2016/11/23/aurelia-authentication-using-firebase/index-fragment.html","self":"blog/2016/11/23/aurelia-authentication-using-firebase/index.json"},"content":"\r\nAs a recovering full-stack developer who went the specialised front-end route a few years ago, the one aspect I have always hated about building any feature-rich web application is authentication. Thankfully a lot of convenient options have popped up over the last couple of years like [Auth0](https://auth0.com/). \r\n\r\nIn this post, we are going to be using Firebase's fantastic authentication functionality in an Aurelia CLI application.\r\n\r\n## Pre-configure Firebase.\r\n\r\nFirstly, create a new Firebase project via the [Firebase developer console](https://console.firebase.google.com).\r\n\r\nNow let's enable authentication. On the left-hand side in the project pane, you'll see \"Authentication\" click that and then at the top, choose the \"Sign-in method\" tab where you'll see a list of providers. For the sake of this article, let's just enable Google because we don't need to provide tokens or application ID's like we do for other providers such as Facebook or Twitter.\r\n\r\nThe sample application in the Github repository provided (at the end of this post) has the other providers wired up, but you'll need to get app credentials and then enable these providers yourself. Once you've done that, click on the name of your app in the left-hand pane at the top. I called my app \"Aurelia Auth App.\"\r\n\r\nThen you'll see three icons; Add Firebase to your iOS app, Add Firebase to your Android app and Add Firebase to your web app. Choose the last one, \"Add Firebase to your web app\", and you'll see a popup which contains the SDK script and some configuration details.\r\n\r\n**Mine looked similar to the following:**\r\n\r\n\r\n\r\n  ```JavaScript\r\n    <script src=\"https://www.gstatic.com/firebasejs/3.6.1/firebase.js\"></script>\r\n    <script>\r\n      // Initialize Firebase\r\n      var config = {\r\n        apiKey: \"AIzaSyD450934850934805934095834095\",\r\n        authDomain: \"aurelia-auth-app.firebaseapp.com\",\r\n        databaseURL: \"https://aurelia-auth-app.firebaseio.com\",\r\n        storageBucket: \"aurelia-auth-app.appspot.com\",\r\n        messagingSenderId: \"567567\"\r\n      };\r\n      firebase.initializeApp(config);\r\n    </script>\r\n  \r\n```\r\n\r\nDon't use my snippet, make sure you get your own, or this tutorial might not work properly for you. Hold onto it; we'll need it soon.\r\n\r\n## Generating an Aurelia app.\r\n\r\nUsing Aurelia CLI, we are going to scaffold a new Aurelia application.\r\n\r\nMake sure you have [Node.js](http://nodejs.org) installed and then open up a terminal window and install the CLI as a global dependency: \r\n\r\n\r\n\r\n  ```JavaScript\r\n    npm install aurelia-cli -g\r\n  \r\n```\r\n\r\nOnce this completes, test the CLI installed correctly by typing: `au -v` and a version number should be displayed. \r\n\r\nNow, let's create our project. We'll call it \"aurelia-secured\" for the sake of this article, but you can call it whatever you want.\r\n\r\n\r\n\r\n  ```JavaScript\r\n    au new aurelia-secured\r\n  \r\n```\r\n\r\nGo through the prompts and choose whatever works for you. I favour using TypeScript, so I selected TypeScript over Babel. Keep in mind code snippets you might encounter in this post are TypeScript, but can be quickly changed to be plain old Javascript.\r\n\r\nDuring the prompts, make sure you choose to install the dependencies as well. This will just run `npm install`, but it is one less step to worry about if you do it during the CLI process.\r\n\r\n## Coding our app.\r\n\r\nFirstly, in the newly created application folder, open up `index.html` and above the script which imports `scripts/vendor-bundle.js` paste in your provided SDK code from Firebase. We do this to ensure Firebase's SDK loads before Aurelia code.\r\n\r\nYour `index.html` file should resemble closely to the following:\r\n\r\n\r\n\r\n  ```JavaScript\r\n    <body aurelia-app=\"main\">\r\n        <script src=\"https://www.gstatic.com/firebasejs/3.6.1/firebase.js\"></script>\r\n        <script>\r\n          // Initialize Firebase\r\n          var config = {\r\n            apiKey: \"AIzaSyD450934850934805934095834095\",\r\n            authDomain: \"aurelia-auth-app.firebaseapp.com\",\r\n            databaseURL: \"https://aurelia-auth-app.firebaseio.com\",\r\n            storageBucket: \"aurelia-auth-app.appspot.com\",\r\n            messagingSenderId: \"567567\"\r\n          };\r\n          firebase.initializeApp(config);\r\n        </script>\r\n        <script src=\"scripts/vendor-bundle.js\" data-main=\"aurelia-bootstrapper\"></script>\r\n    </body>\r\n  \r\n```\r\n\r\nCongratulations, you just added Firebase into your app. If you're wondering why we are not using third party plugins like Aurelia Firebase, it is because I think Firebase already provides an excellent SDK that does not need to be over-complicated or abstracted.\r\n\r\nIf you want to use a third-party plugin, nothing is stopping you. However, this article will be focusing on the official SDK only.\r\n\r\nIf you thought that was easy, now we're going to add in authentication, which isn't any harder. Rather than make you write code step-by-step, line-by-line, **just copy/paste the following well-documented code into `src/app.ts`:**\r\n\r\n\r\n\r\n  ```JavaScript\r\n    // For TypeScript, because Firebase is a global variable\r\n    declare var firebase;\r\n    \r\n    export class App {\r\n        constructor(\r\n            private userLoggedIn = false,\r\n            private authToken = null,\r\n            private user = null\r\n        ) {\r\n            // This mostly gets called on subsequent page loads to determine\r\n            // what the current status of the user is with \"user\" being an object\r\n            // return by Firebase with credentials and other info inside of it\r\n            firebase.auth().onAuthStateChanged(user => {\r\n                this.userLoggedIn = user ? true : false;\r\n                this.user = user;\r\n            });\r\n        }\r\n    \r\n        login(type) {\r\n            let provider;\r\n    \r\n            // Determine which provider to use depending on provided type\r\n            // which is passed through from app.html\r\n            if (type === 'google') {\r\n                provider = new firebase.auth.GoogleAuthProvider();\r\n            } else if (type === 'facebook') {\r\n                provider = new firebase.auth.FacebookAuthProvider();\r\n            } else if (type === 'twitter') {\r\n                provider = new firebase.auth.TwitterAuthProvider();\r\n            }\r\n            \r\n            // Call the Firebase signin method for our provider\r\n            // then take the successful or failed result and deal with\r\n            // it accordingly.\r\n            firebase.auth().signInWithPopup(provider).then((result: any) => {\r\n                // The token for this session\r\n                this.authToken = result.credential.accessToken;\r\n    \r\n                // The user object containing information about the current user\r\n                this.user = result.user;\r\n    \r\n                // Set a class variable to true to state we are logged in\r\n                this.userLoggedIn = true;\r\n            }).catch(error => {\r\n                let errorCode = error.code;\r\n                let errorMessage = error.message;\r\n                let email = error.email;\r\n                let credential = error.credential;\r\n            });\r\n        }\r\n    \r\n        logout() {\r\n            // Self-explanatory signout code\r\n            firebase.auth().signOut().then(() => {\r\n                this.userLoggedIn = false;\r\n            }).catch(error => {\r\n                throw new Error(error);\r\n            });\r\n        }\r\n    }\r\n  \r\n```\r\n\r\n>If you would like to know how you can configure the scope to request additional information from a provider or other configuration options, the Firebase documentation has you covered [here](https://firebase.google.com/docs/reference/).\r\n\r\n**Lastly, add the following into `app.html`:**\r\n\r\n\r\n\r\n  ```JavaScript\r\n    <template>\r\n        <a href=\"javascript:void(0);\" click.delegate=\"login('google')\" if.bind=\"!userLoggedIn\">Login via Google</a>\r\n        <a href=\"javascript:void(0);\" click.delegate=\"login('twiter')\" if.bind=\"!userLoggedIn\">Login via Twitter</a>\r\n        <a href=\"javascript:void(0);\" click.delegate=\"login('facebook')\" if.bind=\"!userLoggedIn\">Login via Facebook</a>\r\n        <a href=\"javascript:void(0);\" click.delegate=\"logout()\" if.bind=\"userLoggedIn\">Logout</a>\r\n    \r\n        <div class=\"profile\" if.bind=\"userLoggedIn && user\">\r\n            <h1>${user.displayName}</h1>\r\n            <h2>${user.email}</h2>\r\n            <img src.bind=\"user.photoURL\" if.bind=\"user.photoURL\">\r\n        </div>\r\n    </template>\r\n  \r\n```\r\n\r\nWe are only showing login links if we are not already logged in using Aurelia's `if.bind` which conditionally adds and removes the element from the DOM. We could also use `show.bind` to achieve the same thing, but the element does not get removed.\r\n\r\nLastly, we have a profile DIV which only gets shown if we are logged in, and we have a user object. Then inside we display some values.\r\n\r\n## Conclusion\r\n\r\nFirebase is great. Aurelia's CLI is fantastic and combining the two allows you to create a fully-fledged client-side application with almost no work. If you would like the source code for the above example, you can find it on Github [here](https://github.com/Vheissu/aurelia-firebase-authentication)."}