{"name":"Bundling an Aurelia Application","description":"Aurelia is a next generation framework that promotes good design patterns and practices. The next version of HTTP, HTTP/2 [https://en.wikipedia.org/wiki/HTTP/2], may very well obsolete the necessity of creating bundles in the future, but we are not there just yet. Nobody likes to see a production application making 256 requests when loading. That's why Aurelia takes bundling very seriously. Read on to find out how to get your app bundled up for deploy using our new CLI.","author":{"name":"AureliaEffect"},"links":{"static":"blog/2015/6/3/bundling-an-aurelia-application","html":"blog/2015/6/3/bundling-an-aurelia-application/index.html","fragment":"blog/2015/6/3/bundling-an-aurelia-application/index-fragment.html","self":"blog/2015/6/3/bundling-an-aurelia-application/index.json"},"content":"\nAurelia is a next generation framework that promotes good design patterns and practices. The next version of HTTP, [HTTP/2](https://en.wikipedia.org/wiki/HTTP/2), may very well obsolete the necessity of creating bundles in the future, but we are not there just yet. Nobody likes to see a production application making 256 requests when loading. That's why Aurelia takes bundling very seriously. Read on to find out how to get your app bundled up for deploy using our new CLI.\n\n> Note: We've drastically improved our bundling technology. Please disregard this article and see the most up to date resources, found [here](http://blog.durandal.io/2015/09/11/bundling-aurelia-apps/).\n\n## Getting Started\n\nLet's begin by creating some bundles. We will use our [skeleton-navigation](http://github.com/aurelia/skeleton-navigation) project as the basis of our work. First, we will run it as is and then we will bundle it to see the difference.\n\n> Note: We assume you have downloaded and set up the navigation skeleton, per [these instructions](http://aurelia.io/get-started.html).\n\nOnce the project is set up, run the following gulp task to view the application in the browser.\n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n     gulp serve\n  </source-code>\n</code-listing>\n\nUp until now, we have not done any bundling. Let's say we decided to put our app into production as is. If we open the browser's dev tools we can see how many requests are being made by the application: \n\n![No of requests made my the application](/content/images/2015/06/unbundled-aurelia-application.jpg)\n\n258! Yep, that's a scary picture for a production scenario. We want to minimize the number of requests. So, let's call `Aurelia-CLI` to the rescue. \n\nBefore we bundle our app, we need to change the `config.js` file a little bit to switch off building `css`. Add `buildCSS: false` in the `config.js`, so that the file looks something like this:\n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n    System.config({\n      \"transpiler\": \"babel\",\n      \"babelOptions\": {\n        \"optional\": [\n          \"es7.decorators\",\n          \"es7.classProperties\",\n          \"runtime\"\n        ]\n      },\n      \"paths\": {\n        \"*\": \"dist/*.js\",\n        \"github:*\": \"jspm_packages/github/*.js\",\n        \"npm:*\": \"jspm_packages/npm/*.js\"\n      },\n      \"buildCSS\": false\n    });\n    \n  </source-code>\n</code-listing>\n\n> Note: We have discovered a possible bug in JSPM related to bundling CSS at the moment. We will investigate further and let you know as soon as we find a solution.\n\n## Installing Aurelia CLI\n\nBundling apps with the Aurelia CLI is a breeze. Let's begin by installing the CLI tool: \n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n     npm install -g aurelia-cli\n  </source-code>\n</code-listing>\n\nFor bundling, we need to install the tool locally to our project too. To do so `cd` into the `skeleton-navigation` project's root and run: \n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n     npm install aurelia-cli --save-dev\n  </source-code>\n</code-listing>\n\n## Bundling JavaScript\n\nNow we are all set to create our first bundle. Before running our bundle command we will tell the `cli` what to bundle. Let's add an `aureliafile.js` in the root of our project and use the configuration bellow:\n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n      var aurelia = require('aurelia-cli');\n    \n      aurelia.command('bundle', {\n        js: {\n          \"dist/app-bundle\": {\n            modules: [\n              '*',\n              'aurelia-bootstrapper',\n              'aurelia-http-client',\n              'aurelia-router',\n              'aurelia-animator-css',\n              'github:aurelia/templating-binding@0.12.0',\n              'github:aurelia/templating-resources@0.12.1',\n              'github:aurelia/templating-router@0.13.0',\n              'github:aurelia/loader-default@0.8.0',\n              'github:aurelia/history-browser@0.5.0'\n            ],\n            options: {\n              inject: true,\n              minify: true\n            }\n          }\n        }\n      });\n  </source-code>\n</code-listing>\n\nNext, let's run the command below from the shell:\n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n    aurelia bundle\n  </source-code>\n</code-listing>\n\nEverything should go well and we now should have a file named `app-bundle.js` in the `dist` folder. As per the configuration in `aureliafile`, we have `inject` set to true. This injects the bundle into `config.js`. As a result, the bundle will be automatically loaded when the application requests any of the modules included in the bundle. We also have `minify` set to `true` to reduce the size of our bundle. \n\nLet's refresh our browser, keeping the dev tool open and see what happens.\n\n> Note: Make sure you clear the browser cache to see the result.\n\n![No of requests after bundling](/content/images/2015/06/after-js-bundling.jpg)\n\n15 requests! That's a significant improvement over 256. But, we can make it even better. As we can see in the picture, we have some requests for templates like `app.html`, `nav-bar.html` etc. In skeleton-navigation we have only 5 templates. But, a non trivial application may have 100s or even more. So, we need a way to bundle them as well. Fortunately, `Aurelia CLI` does have an answer to that too!\n\n## Bundling Templates \n\nLet's teach the `cli` which templates to bundle. We will add a template configuration section in `aureliafile.js`. It should now look like this:\n\n\n<code-listing>\n  <source-code lang=\"JavaScript\">\n      var aurelia = require('aurelia-cli');\n    \n      aurelia.command('bundle', {\n        js: {\n          \"dist/app-bundle\": {\n            modules: [\n              '*',\n              'aurelia-bootstrapper',\n              'aurelia-http-client',\n              'aurelia-router',\n              'aurelia-animator-css',\n              'github:aurelia/templating-binding@0.12.0',\n              'github:aurelia/templating-resources@0.12.1',\n              'github:aurelia/templating-router@0.13.0',\n              'github:aurelia/loader-default@0.8.0',\n              'github:aurelia/history-browser@0.5.0'\n            ],\n            options: {\n              inject: true,\n              minify: true\n            }\n          }\n        },\n        template: {\n          \"dist/app-bundle\": {\n            pattern: 'dist/*.html',\n            options: {\n              inject: true\n            }\n          }\n        }\n      });\n  </source-code>\n</code-listing>\n\nLet's run `aurelia bundle` again. This time a new file named `app-bundle.html` should be created in the `dist` folder. This bundle contains all our templates in a way that [aurelia-loader](http://github.com/aurelia/loader) understands. Since we have set `inject` to true, a `link` tag has been injected at the end of the `body` in our `index.html`.\n\n> Note: You may have to run `aurelia bundle --force` since we already have a JS bundle at this point in the `dist` folder. The cli *will not* overwrite a created bundle normally.\n\nNow, let's reload the application and see the request count again: \n\n![No of requests after bundling templates](/content/images/2015/06/after-bundling-templates.jpg)\n\n10 requests! That's better, isn't it? \n\nThat's how easy it is to create bundles with Aurelia CLI. Once the `aureliafile.js` is in place with proper configuration, all we need to do is run `aurelia bundle`.\n\n### Important Notes When Bundling Templates\n\n* Glob patterns execute relative to `baseURL`\n* You can use patterns like `['dist/**/*.html', '!dist/about/*.html']` as well.\n* Bundle files gets created relative to `baseURL`. So, according to the `aurelifile` config `dist/app-bundle` will be created as `baseURL/dist/app-bundle.js`\n\n### Important Notes When Bundling JS\n\n* Unlike template bundling patterns, it does not glob files. Rather, it globs system.js `paths` like `*/**` or `*`.\n* Bundle config should include proper `module names` instead of file names.\n* Like templates in the bundle file, the JS bundle file also gets created relative to the `baseURL`.\n\n## More to Come...\n\nApart from bundling, the `Aurelia CLI` has some other really cool tricks up its sleave. It can make your development time more pleasing and interesting. The CLI team is working really hard to create a tool that everyone loves. Tell us what you want, what you like or even dislike on our gitter channel and please raise CLI related issues [here](https://github.com/aurelia/cli/issues).\n\nThanks to the CLI team and especially Core Team Member [Shuhel Ahmed](https://github.com/ahmedshuhel) for putting together this post!"}