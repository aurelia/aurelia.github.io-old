{"name":"The New Aurelia-CLI Auto-tracing Bundler","description":"Today, we're pleased to announce the Aurelia-CLI v1.0.0-beta.1 release! The official beta of our CLI now features a new built-in \"auto-tracing\" bundler, which greatly improves the capability, performance, and usability of the built-in bundler.","author":{"name":"Chunpeng Huo"},"links":{"static":"blog/2018/10/8/release-aurelia-cli-with-auto-tracing-bundler","html":"blog/2018/10/8/release-aurelia-cli-with-auto-tracing-bundler/index.html","fragment":"blog/2018/10/8/release-aurelia-cli-with-auto-tracing-bundler/index-fragment.html","self":"blog/2018/10/8/release-aurelia-cli-with-auto-tracing-bundler/index.json"},"content":"\r\nToday, we're pleased to announce the Aurelia-CLI v1.0.0-beta.1 release! The official beta of our CLI now features a new built-in \"auto-tracing\" bundler, which greatly improves the capability, performance, and usability of the built-in bundler.\r\n\r\n> Info\r\n> The CLI's setup for Webpack remains the same as before. This new bundler provides an alternative to Webpack by combining a new auto-tracing bundler with RequireJS or SystemJS.\r\n\r\nThe auto-tracing bundler replaces the [amodro-trace](https://github.com/amodrojs/amodro-trace) based bundler. The implementation is totally new, but on the surface, we maintain maximum backward compatibility.\r\n\r\nA couple of major improvements of the new bundler include:\r\n\r\n1. It removes the burden of maintaining dependencies in `aurelia.json`.\r\n2. It greatly improves compatibility with many NPM packages.\r\n3. [It has extensive documentation](docs/cli/cli-bundler).\r\n\r\nTechnically, the new bundler behaves very similar to our Webpack/aurelia-webpack-plugin setup. For example:\r\n\r\n1. It auto-traces JavaScript dependencies and supports NPM packages in CommonJS, AMD, UMD, and Native ES Module format.\r\n2. It auto-stubs core Node.js modules for running in browser, using the exact same stubs that Webpack and Browserify use.\r\n3. It auto-traces JS/HTML/CSS dependencies in Aurelia view templates. e.g. `<require from=\"...\"></require>`.\r\n\r\nThe new bundler also provides features above and beyond Webpack:\r\n\r\n1. Wrapping `\"moduleName\"` with `PLATFORM.moduleName(\"moduleName\")` is NOT required. The new bundler understands all Aurelia's conventions without the need for a helper.\r\n2. In ESNext apps (not TypeScript apps), `au run --auto-install` can be used to help you install NPM packages. You can keep writing code and the CLI will install missing NPM packages, bundle them, and refresh you browser automatically.\r\n\r\n## Upgrading to the New Bundler\r\n\r\nTo upgrade your existing RequireJS/SystemJS based app:\r\n\r\n1. Make sure you are running on Node.js v8.9.0+.\r\n1. Update `aurelia-cli` in your app's `package.json` and then run `npm install` or `yarn`.\r\n1. Most existing apps should work without any need to update the `aurelia.json` file. However, you could be caught with one breaking change: the way to reference a non-JS main file has changed. The non-JS main (or missing main) is used by some pure CSS NPM packages like font-awesome v4 and normalize.css. For example, if using font-awesome v4, you should remove the explicit dependency configuration `{\"name\": \"font-awesome\", ...` from `aurelia.json`. Have a look at our [CLI Bundler Cookbook](docs/cli/cli-bundler/cook-book) on how to use font-awesome v4 and normalize.css with the latest CLI bundler. It is only easier :)\r\n\r\nOnce your app works, you should start to clean up the `aurelia.json` vendor-bundle dependencies to take advantages of auto-tracing. The following are the minimum required dependencies:\r\n\r\n```JSON\r\n\"aurelia-bootstrapper\",\r\n\"aurelia-loader-default\",\r\n\"aurelia-pal-browser\",\r\n// note all other aurelia-* packages are gone\r\n{\r\n  \"name\": \"aurelia-testing\",\r\n  \"env\": \"dev\"\r\n},\r\n// for requirejs\r\n\"text\",\r\n// or for systemjs\r\n// {\r\n//   \"name\": \"text\",\r\n//   \"path\": \"../node_modules/systemjs-plugin-text\",\r\n//   \"main\": \"text\"\r\n// }\r\n```\r\n\r\nFor any 3rd party dependency, if it's not a shim (has `\"deps\"` or `\"exports\"` or both), not a custom local package (not in node_modules folder), and not a package alias, you can remove its config. Auto-tracing bundles NPM packages automatically without manual configuration in `aurelia.json`.\r\n\r\n## Enabling Caching\r\n\r\nThe new bundler also uses a cache to speed up consecutive builds. To turn it on, update the `aurelia.json` file. You can use `\"cache\": true` to turn it on for all environments:\r\n\r\n```JSON\r\n\"options\": {\r\n  \"minify\": \"stage & prod\",\r\n  \"sourcemaps\": \"dev & stage\",\r\n  \"rev\": false,\r\n  \"cache\": \"dev & stage\"\r\n}\r\n```\r\n\r\nYou will need the task file to enable the new command `au clear-cache`. To get it, use the latest CLI to create a new app, choosing the built-in bundler. Then, copy the following files from the new app to your existing app:\r\n\r\n```Shell\r\naurelia_project/tasks/clear-cache.js (or .ts)\r\naurelia_project/tasks/clear-cache.json\r\n```\r\n\r\nOnly for ESNext apps (not TypeScript), do `npm install --save-dev gulp-cache` or `yarn add -D gulp-cache`, and copy the new `aurelia_project/tasks/transpile.js` file which further improves performance using gulp-cache to cache transpilation results.\r\n\r\n## Updates for Plugin Authors\r\n\r\nFor all Aurelia plugin authors, please update your installation guides to remove any dedicated CLI bundler instructions. The installation of any Aurelia plugin is now the same for Webpack and CLI bundler users: just run `npm install your-plugin`.\r\n\r\nFor more information, read [the CLI Built-in Bundler](docs/cli/cli-bundler) chapter of the Aurelia guides. For any issue/bug, please ask a question on [the Aurelia Discourse Forum](https://discourse.aurelia.io/) or create an issue on [the aurelia-cli GitHub repo](https://github.com/aurelia/cli/issues), and we will help you out.\r\n\r\nHappy Bundling!\r\n\r\n## Full CLI Changelog\r\n\r\n### Bug Fixes\r\n\r\n* fix exception on \"au new\" when running directly in root directory ([8037eef](https://github.com/aurelia/cli/commit/8037eef))\r\n\r\n\r\n### Features\r\n\r\n* **bundler:** auto tracing for requirejs/systemjs ([c4ce02c](https://github.com/aurelia/cli/commit/c4ce02c)), closes [#831](https://github.com/aurelia/cli/issues/831) [#853](https://github.com/aurelia/cli/issues/853) [#842](https://github.com/aurelia/cli/issues/842) [#831](https://github.com/aurelia/cli/issues/831)\r\n* **bundler:** build.options.cache turn on tracing cache and transpile cache ([15af83f](https://github.com/aurelia/cli/commit/15af83f))\r\n* **bundler:** fully support package.json browser field ([5bb81d4](https://github.com/aurelia/cli/commit/5bb81d4)), closes [#579](https://github.com/aurelia/cli/issues/579) [#581](https://github.com/aurelia/cli/issues/581)\r\n* **bundler:** stub core Node.js modules just like browserify and webpack ([19aafee](https://github.com/aurelia/cli/commit/19aafee))\r\n* **bundler:** support both 'json!f.json' and 'f.json' module id. ([ea005fe](https://github.com/aurelia/cli/commit/ea005fe))\r\n* **bundler:** support Node.js direct json loading require(\"foo.json\") ([8fa8800](https://github.com/aurelia/cli/commit/8fa8800))\r\n* **bundler:** support npm package shipped in native es module ([1669a6f](https://github.com/aurelia/cli/commit/1669a6f)), closes [#872](https://github.com/aurelia/cli/issues/872)\r\n* **bundler:** support onRequiringModule(moduleId) callback ([fd49eb1](https://github.com/aurelia/cli/commit/fd49eb1))\r\n* **bundler:** support per package wrapShim setting on dependency config ([3c796ac](https://github.com/aurelia/cli/commit/3c796ac))\r\n* **bundler:** use package.json \"module\" (es module format) over \"main\" ([a3bc63a](https://github.com/aurelia/cli/commit/a3bc63a))\r\n\r\n\r\n### BREAKING CHANGES\r\n\r\n* **bundler:** require minor user code change to support non-js main, like \"main\": \"font-awesome.css\"\r\n* **bundler:** remove support of undocumented \"main\": false, replace with generic \"lazyMain\": true. But this is handled transparently without breaking user's existing app."}